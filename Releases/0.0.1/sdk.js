"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),IncludeSdk=function(){function e(t){_classCallCheck(this,e),this.APIURL="http://takenet-hmg-omni-api.azurewebsites.net/partners",this.IFRAMEURL="https://hmg-blip-sdk.azurewebsites.net/chat",this._apiKey=t,this.openBlipThread()}return _createClass(e,[{key:"_cookieConstants",value:function(){return{BLIP_SDK_UID_KEY:"blipSdkUId",BLIP_SDK_UPW_KEY:"blipSdkUPw",BLIP_SDK_TO_ID_KEY:"blipSdkToId",BLIP_SDK_OWNER_ID_KEY:"blipSdkOId",BLIP_SDK_OWNER_PW_KEY:"blipSdkOPw",BLIP_SDK_USER_NAME_KEY:"blipUserName",BLIP_SDK_USER_PHOTO_URI_KEY:"blipUserPhotoUri",BLIP_SDK_USER_EXTERNAL_ID_KEY:"blipUserExternalId"}}},{key:"setUserAccount",value:function(e){}},{key:"setCookies",value:function(e){var t=new Date;t.setTime(t.getTime()+3e3);var n=t.toUTCString();document.cookie=this._cookieConstants().BLIP_SDK_UID_KEY+"=blipsdk588_test; expires="+n,document.cookie=this._cookieConstants().BLIP_SDK_UPW_KEY+"=MTIzNDU2; expires="+n,document.cookie=this._cookieConstants().BLIP_SDK_TO_ID_KEY+"="+e.toIdentifier+"; expires="+n,document.cookie=this._cookieConstants().BLIP_SDK_OWNER_ID_KEY+"="+e.ownerIdentity+"; expires="+n,document.cookie=this._cookieConstants().BLIP_SDK_OWNER_PW_KEY+"="+e.ownerPassword+"; expires="+n,document.cookie=this._cookieConstants().BLIP_SDK_USER_NAME_KEY+"=Blip SDK Test User; expires="+n,document.cookie=this._cookieConstants().BLIP_SDK_USER_PHOTO_URI_KEY+"=http://i.imgur.com/8oL7Ol8.png; expires="+n,document.cookie=this._cookieConstants().BLIP_SDK_USER_EXTERNAL_ID_KEY+"=ASDHASJD132131; expires="+n}},{key:"openBlipThread",value:function(){var e=this,t="apikey="+this._apiKey;this.getCredentials(t).then(function(t){e.setCookies(t),e.buildChat()}).catch(function(e){console.log(e)})}},{key:"getCredentials",value:function(e){var t=this;return new Promise(function(n,i){t.asyncReq("GET",t.APIURL+"?"+e).then(function(e){var t=JSON.parse(e),o=window.location.host;o==t.domain?n(t):i(new Error("Credentials error"))})})}},{key:"asyncReq",value:function(e,t){return new Promise(function(n,i){var o=new XMLHttpRequest;o.onreadystatechange=function(){o.readyState==XMLHttpRequest.DONE&&(200==o.status?n(o.responseText):i("Error!"))},o.open(e,t,!0),o.send()})}},{key:"buildChat",value:function(){this.setStyle();var e=document.createElement("div");e.id="take-chat",document.getElementsByTagName("body")[0].appendChild(e),e.innerHTML='<span id="blip-close-btn">x</span>';var t=document.createElement("iframe");t.width=290,t.height=400,t.src=this.IFRAMEURL,e.appendChild(t);var n=document.getElementById("blip-close-btn");n.addEventListener("click",function(){"blip-hidden-chat"==e.getAttribute("class")?(e.setAttribute("class","blip-show-chat"),n.innerHTML="x"):(e.setAttribute("class","blip-hidden-chat"),n.innerHTML="^")})}},{key:"getStyle",value:function(){return"\n    #take-chat {\n      background: #ccc;\n      position: fixed;\n      bottom: 0;\n      right: 10px;\n      padding: 40px 10px 24px 10px;\n      overflow: hidden;\n      transition: 700ms;\n    }\n\n    #take-chat iframe { border: 0; }\n\n    #blip-close-btn {\n      position: absolute;\n      top: 5px;\n      right: 10px;\n      font-size: 20px;\n      font-weight: bold;\n      cursor: pointer;\n    }\n\n    .blip-hidden-chat { bottom: -430px !important; }\n    .blip-show-chat { bottom: 0; }\n\n    "}},{key:"setStyle",value:function(){var e=this.getStyle(),t=document.createElement("style"),n=document.getElementsByTagName("head")[0];t.type="text/css",t.styleSheet?t.styleSheet.cssText=e:t.appendChild(document.createTextNode(e)),n.appendChild(t)}}]),e}();